
---

# 14.6.1: Mitigate Spoofing Attacks

#### Core Concepts
*   **IP Address Spoofing:** The act of creating an IP packet with a forged (spoofed) source IP address.
*   **Attacker Goals:**
    *   Hide the attacker's true identity.
    *   Launch Denial of Service (DoS) attacks where replies are sent to an unsuspecting victim.

#### Anti-Spoofing ACL Strategy
The main strategy is to use ACLs to block packets that have a source address that is logically impossible for the interface on which they are received.

---
### Use Case Examples

#### 1. Inbound Filtering on the Internet-Facing Interface
*   **Goal:** Block any traffic arriving from the public internet that has a source IP address that should never originate from the internet. This is sometimes called a "bogon filter."
*   **Logic:** Deny all packets with source addresses from known private, reserved, or invalid ranges.
*   **Addresses to Deny:**
    *   Private Addresses (RFC 1918): `10.0.0.0/8`, `172.16.0.0/12`, `192.168.0.0/16`
    *   Local Host / Loopback: `127.0.0.0/8`
    *   APIPA: `169.254.0.0/16`
    *   All-zeros / All-ones: `0.0.0.0`, `255.255.255.255`
    *   Multicast Range: `224.0.0.0/4`
*   **Example ACL (Inbound on `S0/0/0`):**
    ```
    ! Deny private and reserved source addresses
    access-list 150 deny ip 10.0.0.0 0.255.255.255 any
    access-list 150 deny ip 172.16.0.0 0.15.255.255 any
    access-list 150 deny ip 192.168.0.0 0.0.255.255 any
    access-list 150 deny ip 127.0.0.0 0.255.255.255 any
    ... (and so on for other invalid ranges) ...
    ```

#### 2. Inbound Filtering on an Internal (LAN) Interface
*   **Goal:** Ensure that all traffic entering the router from the internal network has a legitimate source IP from that network's subnet.
*   **Logic:** Permit only source addresses belonging to the local subnet and deny everything else. This prevents an internal user from spoofing an external address to launch an attack.
*   **Example ACL (Inbound on `G0/0` for `192.168.1.0/24` LAN):**
    ```
    ! Permit only traffic sourced from the local LAN
    access-list 105 permit ip 192.168.1.0 0.0.0.255 any
    ! Implicit "deny any" will block all other source IPs
    ```



---

# 14.6.2: Permit Necessary Traffic through a Firewall

#### The "Explicit Permit" Strategy
A highly effective security strategy is to **deny all traffic by default** (using the implicit deny at the end of an ACL) and then **explicitly permit only the specific services that are absolutely necessary**. This creates a more secure "deny-by-default" posture, rather than trying to block an infinite list of potential threats.

---
#### Practical Example: ACL on an Internet-Facing Firewall
The following example shows an ACL applied **inbound on the internet interface (`S0/0/0`)** to control traffic.

##### 1. Permitting Public Services to an Internal Server
*   **Goal:** Allow anyone from the internet to access specific services (DNS, SMTP, FTP) hosted on the internal server `192.168.20.2`.
*   **Rules:**
    *   `permit udp any host 192.168.20.2 eq domain` (Allow DNS queries)
    *   `permit tcp any host 192.168.20.2 eq smtp` (Allow incoming email)
    *   `permit tcp any host 192.168.20.2 eq ftp` (Allow FTP access)

##### 2. Permitting Remote Administrative Access
*   **Goal:** Allow a *specific* administrator at IP `200.5.5.5` to manage the router itself (`10.0.1.1`) and receive management traffic.
*   **Rules:**
    *   `permit tcp host 200.5.5.5 host 10.0.1.1 eq 22` (Allow SSH access from the admin's IP only)
    *   `permit udp host 200.5.5.5 host 10.0.1.1 eq syslog` (Allow syslog messages from the admin's server)
    *   `permit udp host 200.5.5.5 host 10.0.1.1 eq snmptrap` (Allow SNMP traps from the admin's server)

---
#### Summary of the ACL Rules

| Rule      | Source                | Destination           | Protocol/Port      | Purpose                                     |
| :-------- | :-------------------- | :-------------------- | :----------------- | :------------------------------------------ |
| DNS       | `any`                 | Server (192.168.20.2) | `UDP/53 (domain)`  | Allow public access to DNS server.          |
| SMTP      | `any`                 | Server (192.168.20.2) | `TCP/25 (smtp)`    | Allow public access to email server.        |
| FTP       | `any`                 | Server (192.168.20.2) | `TCP/21 (ftp)`     | Allow public access to FTP server.          |
| **SSH**   | **Admin (200.5.5.5)** | **Router (10.0.1.1)** | **`TCP/22`**       | **Secure remote management from one IP.**   |
| Syslog    | Admin (200.5.5.5)     | Router (10.0.1.1)     | `UDP/514 (syslog)` | Allow router to receive logs from admin server. |
| SNMP      | Admin (200.5.5.5)     | Router (10.0.1.1)     | `UDP/162 (snmptrap)` | Allow router to receive traps from admin server. |


---

# 14.6.3: Mitigate ICMP Attacks

#### Core Concept
ICMP is a double-edged sword. While essential for network diagnostics and operation (like `ping` and error messaging), it can also be exploited by attackers for reconnaissance (network mapping) and Denial of Service (DoS) attacks. A good security policy **denies dangerous ICMP types** while **permitting necessary ones**.

---
#### Recommended ICMP Filtering Strategy

The strategy is to create specific rules for ICMP traffic, usually separating inbound (from the internet) and outbound (to the internet) policies.

| Direction          | Recommended Action | Permitted ICMP Message Types                               | Reason                                                                                                  |
| :----------------- | :----------------- | :--------------------------------------------------------- | :------------------------------------------------------------------------------------------------------ |
| **Inbound** (from Internet) | **PERMIT**         | `echo-reply`, `source-quench`, `unreachable`               | Allows responses to pings *initiated from inside*, congestion control, and important error messages.    |
| **Inbound** (from Internet) | **DENY**           | `echo` (ping), `redirect`, and **all others**              | **Blocks attackers from pinging your internal network** and prevents them from altering routing tables. |
| **Outbound** (to Internet)  | **PERMIT**         | `echo`, `parameter-problem`, `packet-too-big`, `source-quench` | Allows internal users to ping outside and supports essential functions like Path MTU Discovery. |

---
#### Configuration Examples

##### Example 1: Inbound ICMP Filter (ACL 112)
*   **Purpose:** To be applied **inbound** on the internet-facing interface (`S0/0/0`). It blocks malicious ICMP while allowing necessary replies.

```
! ACL 112: Inbound ICMP Policy
access-list 112 permit icmp any any echo-reply         // Allows replies to our pings
access-list 112 permit icmp any any source-quench      // Allows congestion control messages in
access-list 112 permit icmp any any unreachable        // Allows error messages (e.g., port closed) in
access-list 112 deny   icmp any any                    // CRITICAL: Denies all other ICMP (like pings from outside)
access-list 112 permit ip   any any                    // CRITICAL: Allows all non-ICMP traffic (HTTP, DNS, etc.)
```

##### Example 2: Outbound ICMP Filter (ACL 114)
*   **Purpose:** To filter traffic **originating from the internal network** (`192.168.1.0/24`). This could be applied `outbound` on `S0/0/0` or `inbound` on the LAN interface `G0/0`.

```
! ACL 114: Outbound ICMP Policy
access-list 114 permit icmp 192.168.1.0 0.0.0.255 any echo             // Allows our users to ping outside
access-list 114 permit icmp 192.168.1.0 0.0.0.255 any parameter-problem  // Allows our devices to send header error messages
access-list 114 permit icmp 192.168.1.0 0.0.0.255 any packet-too-big     // Crucial for Path MTU Discovery
access-list 114 permit icmp 192.168.1.0 0.0.0.255 any source-quench    // Allows our devices to request less traffic
access-list 114 deny   icmp any any                                    // Denies other outbound ICMP types
access-list 114 permit ip   any any                                    // Allows all other outbound traffic
```


---

# 14.6.4: Mitigate SNMP Attacks

#### The Problem
*   **Simple Network Management Protocol (SNMP)** is a useful tool for remotely monitoring and managing network devices.
*   However, it is also a common target for attackers who can exploit its vulnerabilities to gain information about or control over your network.

---
#### Mitigation Strategies

There are two primary methods to protect against SNMP exploits, with one being far more effective than the other.

| Mitigation Method    | Description                                       | Effectiveness & Limitations                                                                |
| :------------------- | :------------------------------------------------ | :----------------------------------------------------------------------------------------- |
| **1. ACL Filtering** | Use an ACL to permit SNMP traffic **only** from authorized management stations and deny it from all other sources. | **Good:** This reduces the attack surface significantly. <br> **Limitation:** It is still vulnerable if an attacker successfully **spoofs** the IP address of an authorized system. |
| **2. Disable Service** | Turn off the SNMP service completely on any device where it is not absolutely required. | **Best / Most Effective:** This completely **eliminates the vulnerability**. An attacker cannot exploit a service that is not running. |

#### The Recommended Solution
The most secure approach is to disable SNMP unless you have a specific and essential need for it.

*   **Command to Disable SNMP on Cisco IOS:**
    ```
    Router(config)# no snmp-server
    ```