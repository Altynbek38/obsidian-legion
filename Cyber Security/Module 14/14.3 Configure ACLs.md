
---

# 14.3.1: Guidelines for ACL Creation

#### Core Principle: Plan First
All ACLs, especially complex ones with multiple rules (ACEs), must be planned *before* configuration to avoid errors and unintended network outages.

#### Recommended Workflow for Complex ACLs
It is best practice to build an ACL offline before applying it to a router.

1.  **Plan in a Text Editor:** Clearly define the policy goals and write out the logic of what you want to permit and deny.
2.  **Write the Commands:** Translate your plan into the specific Cisco IOS `access-list` commands.
3.  **Add Remarks (Comments):** Use the `remark` command to document the purpose of the ACL and its individual entries. This is crucial for future troubleshooting.
4.  **Apply the Configuration:** Copy and paste the completed and documented commands into the device's CLI.
5.  **Test Thoroughly:** Always verify that the ACL is working as intended, filtering the correct traffic without blocking legitimate users.


---

# 14.3.2: Numbered Standard IPv4 ACL Syntax

#### Command Structure
The global configuration command to create a numbered standard ACL is:
`Router(config)# access-list [number] {deny | permit | remark} [source] [source-wildcard] [log]`

To remove the entire ACL:
`Router(config)# no access-list [number]`

---
#### Parameter Breakdown

| Parameter | Description |
| :--- | :--- |
| **`access-list-number`** | The ID of the ACL. For standard IPv4 ACLs, the range is **`1-99`** or **`1300-1999`**. |
| **`deny \| permit`** | The action to take if a packet matches the rule. |
| **`remark [text]`** | (Optional) Adds a comment or description to the ACL for documentation. Highly recommended for complex ACLs. |
| **`source`** | The source IPv4 address to check. Can be a network address, a single host IP, or the keyword `any`. |
| **`source-wildcard`** | (Optional) The wildcard mask to apply to the source address. If omitted, a mask of `0.0.0.0` is assumed (matching only that specific host). |
| **`log`** | (Optional) Generates a console log message for any packet that matches the ACE. **Warning:** This is CPU-intensive and should only be used for temporary troubleshooting. |


---

# 14.3.3: Named Standard IPv4 ACL Syntax

Named ACLs are the preferred method because their names make their purpose clear.

#### Configuration Steps
1.  **Create the ACL and Enter Sub-Configuration Mode:**
    Use the `ip access-list standard [NAME]` command. It's best practice to use all caps for the name.
    ```
    Router(config)# ip access-list standard NO-ACCESS
    ```
2.  **Add ACEs (Access Control Entries):**
    After running the command above, the router enters a dedicated configuration mode: `(config-std-nacl)#`. From here, you can add your `permit`, `deny`, and `remark` statements directly.
    ```
    Router(config-std-nacl)# permit host 192.168.10.1
    Router(config-std-nacl)# deny 192.168.20.0 0.0.0.255
    Router(config-std-nacl)# permit any
    ```

#### Key Differences from Numbered ACLs
*   You enter a special **sub-configuration mode** (`config-std-nacl`).
*   You do not need to repeat the `access-list` command for each new rule.
*   This mode makes it much easier to manage and edit individual lines within the ACL.

#### Naming Rules
*   Names are **alphanumeric** and **case-sensitive**.
*   Names must be **unique**.

#### Removal Command
To delete the entire named ACL:
`Router(config)# no ip access-list standard [NAME]`


---

# 14.3.4: Numbered Extended IPv4 ACL Syntax

#### Core Concept
Extended ACLs offer more granular control than standard ACLs. They can filter traffic based on:
*   **Protocol** (e.g., TCP, UDP, ICMP)
*   **Source AND Destination** IPv4 address
*   **Source AND Destination** port numbers
*   Other specific options

#### Command Syntax
The syntax is more complex to accommodate the extra parameters:
```
access-list [number] {permit|deny} [protocol] [source] [wildcard] [operator port] [destination] [wildcard] [operator port] [established] [log]
```
---
#### Parameter Breakdown

| Parameter | Description |
| :--- | :--- |
| **`access-list-number`** | The ID of the ACL. For extended IPv4 ACLs, the range is **`100-199`** or **`2000-2699`**. |
| **`protocol`** | The Layer 3 protocol. Common keywords: `tcp`, `udp`, `icmp`, or `ip` to match all. |
| **`source` & `destination`** | The source/destination IP addresses. Use `host` or `any` keywords for simplicity. |
| **`operator port`** | (Optional) Filters by Layer 4 port number. **Operators:**<br>- `eq` (equal to)<br>- `neq` (not equal to)<br>- `gt` (greater than)<br>- `lt` (less than) |
| **`established`** | (Optional, **TCP only**) A key security feature. Allows return traffic for connections that were initiated from inside the network. Blocks external attempts to start a connection. |
| **`log`** | (Optional) Logs matching packets. Use only for troubleshooting as it consumes CPU. |

---
#### Application and Order

*   **Application:** Extended ACLs are applied to an interface using the same command as standard ACLs:
    `Router(config-if)# ip access-group [number] {in | out}`
*   **Processing Order:** The order of the statements is critical. The router processes them sequentially from top to bottom exactly as you entered them.


---

# 14.3.5: Filtering by Protocols and Port Numbers

When creating extended ACLs, you first specify the protocol (Layer 3) and then, if applicable, the port number (Layer 4).

#### Protocol Selection (Layer 3)
You must specify which protocol to filter. The most common options are:
*   **`ip`**: Matches *any* internet protocol.
*   **`tcp`**: Transmission Control Protocol (connection-oriented).
*   **`udp`**: User Datagram Protocol (connectionless).
*   **`icmp`**: Internet Control Message Protocol (used by `ping`, `traceroute`, etc.).

> **Note:** If a protocol isn't available as a keyword (e.g., GRE), you can use its IP protocol number instead (e.g., ICMP is 1, TCP is 6, UDP is 17).

---
#### Port Selection (Layer 4)
The protocol you choose at Layer 3 determines which port options are available at Layer 4. You can specify ports using either a keyword or a number.

| Method | Description | Examples |
| :--- | :--- | :--- |
| **Keyword** | Pre-defined names for common services. **Benefit:** Makes the ACL much easier to read and understand. | `www` (80), `ftp` (21), `telnet` (23), `smtp` (25), `pop3` (110) |
| **Number** | The literal port number. **Required** when no keyword exists. | `22` (for SSH), `443` (for HTTPS), `3389` (for RDP) |

> **Pro Tip:** Use the `?` in the CLI at any stage to see a list of available protocols and port keywords. This is extremely helpful when building complex ACEs.


---

# 14.3.6: Configuration Examples (Protocols & Ports)

This section provides practical examples of how to apply port filtering in extended ACLs.

#### Scenario 1: Using Keywords vs. Numbers (When you have a choice)

*   **Goal:** Permit HTTP traffic from any source to any destination.
*   **Method 1 (Keyword - Preferred):** Using the pre-defined name for the service makes the ACL easier to read.
    ```
    R1(config)# access-list 100 permit tcp any any eq www
    ```
*   **Method 2 (Number):** Functionally identical to using the keyword.
    ```
    R1(config)# access-list 100 permit tcp any any eq 80
    ```
*   **Key takeaway:** Both ACEs achieve the exact same result. The keyword is just an alias for the number.

---

#### Scenario 2: When a Keyword is Not Available (Must use numbers)

*   **Goal:** Permit SSH and HTTPS traffic.
*   **Logic:** Cisco IOS does not have built-in keywords for many common protocols. In these cases, you **must** use the numerical port number.
*   **Commands:**
    ```
    R1(config)# access-list 100 permit tcp any any eq 22      // Permits SSH
    R1(config)# access-list 100 permit tcp any any eq 443     // Permits HTTPS
    ```


---

# 14.3.7: The `established` Keyword in Extended ACLs

#### Core Concept
The `established` keyword provides a basic form of **stateful firewalling** for TCP traffic. It is a security feature that allows internal users to establish connections with the outside world and only permits the return traffic for those specific connections.

#### How It Works
1.  **Inside Initiates:** An internal user sends a request (e.g., to a web server). This traffic is allowed out by a separate outbound ACL.
2.  **Outside Responds:** The web server sends a reply.
3.  **ACL Checks the Reply:** An inbound ACL with the `established` keyword checks the returning packet.
4.  **The "ACK/RST" Rule:** The ACL permits the packet **only if** its TCP header has the **ACK** (acknowledgment) or **RST** (reset) flag set. These flags indicate the packet is part of an *existing* conversation, not a *new* one.
5.  **Result:** All attempts by external hosts to initiate a *new* connection are blocked by default.

---
#### Configuration Example

*   **Goal:** Allow users on the `192.168.10.0/24` network to browse the web, but block all incoming connections initiated from the internet.

*   **Command:**
    ```
    R1(config)# access-list 120 permit tcp any 192.168.10.0 0.0.0.255 established
    ```

*   **Command Breakdown:**
    *   `permit tcp`: Allow TCP traffic.
    *   `any`: From any source IP on the internet.
    *   `192.168.10.0 0.0.0.255`: To any destination on our internal network.
    *   `established`: **BUT ONLY IF** it's part of an existing connection (has ACK/RST flag).

*   **Application:**
    This ACL is often applied **outbound on the internal (LAN) interface**. As return traffic is routed back towards the LAN, it exits the router through this interface.
    ```
    R1(config)# interface g0/0/0
    R1(config-if)# ip access-group 120 out
    ```


---

# 14.3.8: Named Extended IPv4 ACL Syntax

Named extended ACLs are the modern and preferred method for creating complex access lists, as their descriptive names make them easier to manage and understand.

#### Configuration Steps

1.  **Create the ACL & Enter Sub-Configuration Mode:**
    Use the `ip access-list extended [NAME]` command. This will create the ACL and immediately place you into a dedicated configuration mode.
    ```
    Router(config)# ip access-list extended NO-FTP-ACCESS
    ```

2.  **Add ACEs in `(config-ext-nacl)#` mode:**
    Once in the sub-configuration mode, you can add your `permit`, `deny`, and `remark` statements directly, without repeating the initial command.
    ```
    Router(config-ext-nacl)# remark --- Deny all FTP traffic ---
    Router(config-ext-nacl)# deny tcp any any eq ftp
    Router(config-ext-nacl)# deny tcp any any eq ftp-data
    Router(config-ext-nacl)# permit ip any any
    ```

#### Key Advantages over Numbered Extended ACLs
*   **Dedicated Sub-configuration Mode:** Provides a cleaner and more organized way to manage rules.
*   **Easier Editing:** Allows for simple addition and deletion of individual lines.
*   **Clarity:** A descriptive name like `BLOCK-GUEST-WIFI` is much more informative than `access-list 101`.

#### Naming Rules
*   Alphanumeric
*   Case-sensitive
*   Must be unique


---

# 14.3.9: Named Extended IPv4 ACL Example

#### Core Scenario
This is a practical example of a common security policy: allow internal users to browse the web, but block all unsolicited incoming traffic from the internet. This is achieved using two separate named extended ACLs applied to the router's internal (LAN) interface.

---

#### ACL #1: `SURFING` (Filtering Outgoing Traffic)
*   **Purpose:** To permit traffic *originating from* the internal network (`192.168.10.0/24`) that is destined for web servers (HTTP & HTTPS).
*   **Direction:** Applied **`inbound`** on the LAN interface (`G0/0/0`).
    *   *Logic:* Packets from internal PCs **enter** the router through this interface.
*   **Rules:**
    ```
    ip access-list extended SURFING
     permit tcp 192.168.10.0 0.0.0.255 any eq 80
     permit tcp 192.168.10.0 0.0.0.255 any eq 443
    ! Implicit deny any (blocks all other outgoing traffic)
    ```

---

#### ACL #2: `BROWSING` (Filtering Return Traffic)
*   **Purpose:** To permit only the *return traffic* from web servers that is part of an existing connection.
*   **Direction:** Applied **`outbound`** on the LAN interface (`G0/0/0`).
    *   *Logic:* Return packets from the internet are routed and then **exit** the router through this interface to reach the PC.
*   **Rules:**
    ```
    ip access-list extended BROWSING
     permit tcp any 192.168.10.0 0.0.0.255 established
    ! Implicit deny any (blocks all new connections from the internet)
    ```

---
#### Configuration Summary

| ACL Name  | Interface | Direction | Purpose                                |
| :-------- | :-------- | :-------- | :------------------------------------- |
| `SURFING` | `G0/0/0`  | `in`      | Allows internal users to start web sessions. |
| `BROWSING`| `G0/0/0`  | `out`     | Allows only established web replies back in. |

#### Verification
*   Use the `show access-lists` command to verify configuration and see statistics.
*   The `(matches)` counter next to an ACE shows how many packets have been filtered by that specific rule, confirming the ACL is working.