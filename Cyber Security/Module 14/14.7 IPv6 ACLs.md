
---

# 14.7.1: IPv6 ACL Overview

#### The Challenge: IPv6 Transition Risks
As networks migrate from IPv4 to IPv6, a long period of coexistence creates new security vulnerabilities.

*   **Dual-Stack Environments:** A device or network that runs both IPv4 and IPv6 simultaneously. This is the most common transition method.
*   **The Core Problem:** Attackers can leverage the weaknesses or trust models of one protocol to attack the other. For example, using an established IPv4 connection to launch an attack against the IPv6 infrastructure.

---
#### Example Exploit: IPv6 Tunneling Attack
This example shows how an attacker can bypass an IPv4 firewall to attack an internal IPv6 network.

*   **Key Technology:** **Teredo Tunneling**
    *   An automatic IPv6 transition technology.
    *   It works by embedding (encapsulating) IPv6 packets inside standard **IPv4 UDP packets**.
    *   This allows IPv6 devices to communicate across IPv4 networks, even through NAT.

*   **The Attack Path (Step-by-Step):**
    1.  **Gains Foothold (IPv4):** An attacker compromises a host on the internal IPv4 network.
    2.  **Sends Rogue RAs:** The compromised host sends fake IPv6 **Router Advertisements (RAs)**.
    3.  **Hosts Auto-configure:** Other dual-stack hosts on the LAN receive these rogue RAs and *silently and automatically* configure their own IPv6 stacks, often creating Teredo tunnels out to the attacker.
    4.  **Firewall Bypass:** The IPv4 firewall is blind to the attack. It only sees legitimate-looking **IPv4 UDP traffic** (the tunnel) and allows it.
    5.  **Pivots and Attacks (IPv6):** The attacker now has an IPv6 foothold inside the network and can move ("pivot") to compromise other hosts through this new, unmonitored channel.

---
#### The Solution
*   A specific security strategy is needed to mitigate attacks against IPv6 protocols and infrastructure.
*   **IPv6 ACLs** are a primary tool used for filtering traffic at the network edge to prevent these types of exploits.


---

# 14.7.2: IPv6 ACL Syntax

IPv6 ACLs are conceptually similar to IPv4 extended ACLs but have some crucial differences in syntax and capabilities.

#### Key Differences from IPv4 ACLs
*   **Named Only:** All IPv6 ACLs **must** be named. There are no numbered IPv6 ACLs.
*   **No "Standard" ACLs:** There is no equivalent to a source-only standard ACL. All IPv6 ACLs are inherently like extended ACLs.
*   **No Wildcard Masks:** IPv6 ACLs use a **prefix-length** (e.g., `/64`) instead of a wildcard mask, which is much simpler.
*   **Different Application Command:** They are applied to an interface using `ipv6 traffic-filter`, not `ip access-group`.

---
#### Configuration Commands

1.  **Create the ACL (and enter config mode):**
    ```
    Router(config)# ipv6 access-list [NAME-IN-CAPS]
    ```

2.  **Apply to an Interface:**
    ```
    Router(config-if)# ipv6 traffic-filter [NAME-IN-CAPS] {in | out}
    ```

---
#### Syntax Parameter Breakdown
Inside the `(config-ipv6-acl)#` mode, you define rules using the following parameters:

| Parameter                 | Description                                                                       |
| :------------------------ | :-------------------------------------------------------------------------------- |
| `deny \| permit`          | The action to take.                                                               |
| `protocol`                | The protocol to filter (e.g., `tcp`, `udp`, `icmpv6`, or `ipv6` for all).           |
| `source/destination-ipv6-prefix / prefix-length` | The IPv6 address and prefix length (e.g., `2001:DB8:ACAD::/64`). **Uses prefix-length, NOT wildcard masks.** |
| `any`                     | A keyword that matches any IPv6 address (`::/0`).                                   |
| `host`                    | A keyword to specify a single host address (equivalent to a `/128` prefix).        |
| `operator [port-number]`  | (Optional) Compares port numbers. Operators include `eq`, `neq`, `gt`, `lt`, and `range`. |
| `dscp value`              | (Optional) Matches Quality of Service (QoS) markings.                             |
| `fragments`               | (Optional) Matches fragmented packets.                                            |
| `log`                     | (Optional) Logs matching packets to the console.                                  |
| `sequence value`          | (Optional) Manually specifies the sequence number for the rule.                   |
| `time-range name`         | (Optional) Applies the rule only during a specified time period.                  |


---

# 14.7.3: Configure IPv6 ACLs

#### IPv6 Implicit Rules
IPv6 ACLs have a set of implicit rules at the end of every list, similar to IPv4's `deny any`. However, the IPv6 rules are more complex to support essential network operations.

1.  **Implicit Deny:**
    *   `deny ipv6 any any`
    *   Just like in IPv4, if a packet doesn't match any of your explicit `permit` rules, it is dropped.

2.  **Implicit Permit for Neighbor Discovery (NDP):**
    *   `permit icmp any any nd-na` (Neighbor Advertisement)
    *   `permit icmp any any nd-ns` (Neighbor Solicitation)
    *   **CRITICAL:** These two rules are **automatically added** to every IPv6 ACL applied to an interface. They are necessary for **Neighbor Discovery Protocol (NDP)** to function. NDP is the IPv6 equivalent of ARP, and without it, devices on a local network cannot resolve each other's MAC addresses and cannot communicate.

#### The Risk of Explicitly Denying Everything
*   If you manually add an explicit `deny ipv6 any any` at the end of your ACL, it will be placed *before* the implicit NDP permit rules.
*   **Consequence:** The explicit deny will match and drop the NDP packets, effectively **breaking all local IPv6 communication** on that segment.

---
#### Best Practice Configuration
To avoid breaking NDP and to make the ACL's logic clear, it is best practice to **explicitly configure** the rules you need, including the final deny.

*   **Goal:** Only allow traffic from the `2001:DB8:1:1::/64` LAN.
*   **Recommended ACL:**
    ```
    ipv6 access-list LAN_ONLY
     ! 1. Permit the desired traffic
     permit ipv6 2001:db8:1:1::/64 any

     ! 2. Explicitly permit the essential NDP messages
     permit icmp any any nd-na
     permit icmp any any nd-ns

     ! 3. Explicitly deny all other traffic for clarity
     deny ipv6 any any
    ```
*   **Benefit:** This approach makes the ACL self-documenting. Anyone reading it can see exactly what is permitted and denied without having to remember the implicit rules.