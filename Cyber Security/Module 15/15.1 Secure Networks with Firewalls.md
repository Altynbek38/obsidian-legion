
---

# 15.1.1: Firewalls

#### Core Concept
*   A **firewall** is a system that enforces an access control policy between different networks (e.g., between your internal private network and the public internet).

---
#### Common Properties
Firewalls are designed to be:
*   **Resistant to Attacks:** The firewall itself is a hardened system, difficult to compromise.
*   **A Single Transit Point:** It acts as a chokepoint, forcing all traffic between networks to pass through it for inspection.
*   **A Policy Enforcer:** Its primary job is to apply a set of rules to either permit or deny traffic.

---
#### Benefits

| Benefit | Description |
| :--- | :--- |
| **Protection** | Shields sensitive internal hosts, resources, and applications from untrusted networks. |
| **Protocol Sanitization** | Can inspect and block malformed packets that try to exploit flaws in network protocols. |
| **Malicious Data Blocking** | Prevents known malicious content from reaching internal servers and clients. |
| **Centralized Management** | Simplifies security by consolidating network access control onto a few devices instead of managing it on every single host. |

---
#### Limitations

| Limitation | Description |
| :--- | :--- |
| **Single Point of Failure** | If the firewall fails or is misconfigured, it can either bring down the entire network connection or leave it completely exposed. |
| **Performance Impact** | The process of inspecting every packet adds latency and can become a network bottleneck. |
| **User Circumvention** | Users may actively try to bypass the firewall (using proxies, personal VPNs, etc.), creating new, unmonitored security holes. |
| **Evasion Techniques** | Attackers can disguise or tunnel malicious traffic inside legitimate protocols (like HTTPS or DNS), making it difficult for some firewalls to detect. |
| **Application Incompatibility**| Some complex or non-standard applications may not function correctly when their traffic is filtered by a firewall. |


---

# 15.1.2: Types of Firewalls

This section breaks down firewalls into categories based on how they inspect traffic and which OSI layers they operate on.

#### 1. Packet Filtering (Stateless) Firewall
*   **Key Feature:** **Stateless** — it examines each packet in isolation and has no memory of previous packets or connections.
*   **OSI Layers:** Operates at **Layer 3** (Network) and **Layer 4** (Transport).
*   **Filtering Criteria:** Makes `permit`/`deny` decisions based on:
    *   Source/Destination IP Address
    *   Protocol (TCP/UDP)
    *   Source/Destination Port Number
*   **Analogy:** A basic ACL on a router is a form of stateless packet filtering.

#### 2. Stateful Firewall
*   **Key Feature:** **Stateful** — it is the most common type of firewall. It maintains a **state table** to track the status of all active connections.
*   **OSI Layers:** Operates at **Layers 3, 4, and 5** (Session).
*   **How it Works:**
    *   It understands the context of a conversation (e.g., a TCP handshake).
    *   If an internal host initiates a connection, the firewall records it and automatically allows the return traffic for that *specific session*.
    *   It blocks any unsolicited traffic from the outside that isn't part of an established connection.

#### 3. Application Gateway Firewall (Proxy Firewall)
*   **Key Feature:** Acts as a **proxy** (an intermediary) between the client and the server. The internal client never connects directly to the destination.
*   **OSI Layers:** Operates up to **Layer 7** (Application).
*   **How it Works:**
    *   The client connects to the proxy; the proxy connects to the server on the client's behalf.
    *   Because it operates at Layer 7, it can deeply inspect the content of application traffic (e.g., filter specific commands in an FTP session or block malicious code in web traffic).

#### 4. Next-Generation Firewall (NGFW)
*   **Key Feature:** An evolution of the stateful firewall that integrates multiple security services into one device.
*   **Core Capabilities:**
    *   **Stateful Packet Inspection** (the foundation).
    *   **Integrated Intrusion Prevention System (IPS):** Can detect and block known exploits.
    *   **Application Awareness and Control:** Can identify and control specific applications (like Skype or BitTorrent) regardless of the port they use.
    *   **Threat Intelligence:** Can be updated with real-time feeds about emerging threats.

---
#### Other Firewall Types

| Type | Description |
| :--- | :--- |
| **Host-based Firewall** | Software running on a single computer or server (e.g., Windows Defender Firewall). |
| **Transparent Firewall** | A Layer 2 firewall that acts like an invisible "bump on the wire," filtering traffic between two bridge-group interfaces. |
| **Hybrid Firewall** | A combination of different firewall types (e.g., a stateful firewall that also includes application inspection capabilities). |


---

# 15.1.4: Packet Filtering Firewall (Benefits and Limitations)

#### Core Concept Recap
*   A **Packet Filtering Firewall** is a **stateless** firewall, typically implemented as an Access Control List (ACL) on a router.
*   It makes simple `permit`/`deny` decisions for each packet in isolation, based on Layer 3 and Layer 4 information (IPs, ports, protocols).

---
#### Benefits

| Benefit | Description |
| :--- | :--- |
| **High Performance** | Being stateless requires very little CPU and memory, resulting in minimal impact on network speed. |
| **Low Cost** | This functionality is a standard feature built into most routers, so there's no extra cost. |
| **Simplicity** | The rules are easy to understand and implement for basic filtering tasks. |
| **First Line of Defense**| Provides a crucial, initial layer of security at the network edge. |

---
#### Limitations

| Limitation                       | Description                                                                                                                                                                        |
| :------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Stateless Nature**             | The fundamental weakness. It has **no memory of connections**. It cannot tell if an incoming packet is a legitimate reply or a malicious new connection attempt.                   |
| **Vulnerable to IP Spoofing**    | Because it doesn't track connection states, an attacker can easily craft a packet with a spoofed source IP that matches a `permit` rule.                                           |
| **Poor Fragmentation Handling**  | It can only inspect the header of the *first* packet fragment. All subsequent fragments of the same packet are often allowed through without inspection, creating a security hole. |
| **No Support for Dynamic Ports** | It cannot handle complex protocols that negotiate ports dynamically (like active FTP or some VoIP), forcing admins to open large, insecure port ranges.                            |
| **Complex to Manage at Scale**   | While individual rules are simple, building and maintaining long, complex ACLs can become very difficult and prone to error.                                                       |


---

# 15.1.5: Stateful Firewall Benefits and Limitations

#### Core Concept Recap
*   A **Stateful Firewall** is a significant upgrade from a stateless one. Its key feature is the **state table**, which allows it to track the state of active network connections (e.g., TCP sessions).

---
### Benefits and Limitations

| Benefits | Limitations |
| :--- | :--- |
| **Primary Means of Defense:** Filters unwanted traffic and is the foundation of modern network security. | **No Application Layer Inspection:** It understands connections (Layer 4), but not the *content* of the data within them (Layer 7). It can't tell if an HTTP packet contains a virus. |
| **Strong Packet Filtering:** Offers much stricter security than stateless filtering by understanding the context of a connection. | **Limited Tracking of Stateless Protocols:** It's less effective with stateless protocols like UDP and ICMP because they don't have a formal connection state to track. |
| **Improved Performance over Proxies:** Faster than application-level proxy firewalls because it makes decisions at lower OSI layers. | **Difficulty with Dynamic Ports:** Can struggle with complex protocols that negotiate multiple, dynamic ports for data transfer, sometimes requiring admins to open large port ranges. |
| **Defends Against Spoofing & DoS:** By checking if an incoming packet belongs to an existing session in its state table, it can easily drop spoofed packets that are trying to fake a connection. | **No User Authentication:** It validates connections based on IP addresses and ports, not on the identity of the user. |
| **Richer Data Logging:** Can provide more detailed logs about connections and sessions, not just individual packets. | |