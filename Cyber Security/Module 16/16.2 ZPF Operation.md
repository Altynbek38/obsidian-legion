
---

# 16.2.1: ZPF Actions

When defining a policy for traffic between zones, a Zone-Based Policy Firewall can take one of three actions.

| Action    | Description                                                                                             | Analogy to ACLs                                                                  |
| :-------- | :------------------------------------------------------------------------------------------------------ | :------------------------------------------------------------------------------- |
| **Inspect** | Performs **stateful packet inspection**. It creates a session in the state table and automatically allows the return traffic for that specific session. This is the most common and secure action for a stateful firewall. | **Smart `permit`**: It permits the initial traffic and implicitly permits the reply. |
| **Drop**    | Silently discards the packet. This is an explicit `deny`. A `log` option can be added to record information about the dropped packets.                                                              | **`deny`**                                                                       |
| **Pass**    | A **stateless** `permit`. It forwards the packet but does **not** create a session or track the connection. It does not automatically allow return traffic. This is rarely used and is typically for protocols where stateful inspection is not possible or desired. | **`permit`**                                                                     |


---

# 16.2.2: ZPF Rules for Transit Traffic

The action a Zone-Based Firewall takes on a packet depends entirely on whether the source (ingress) and destination (egress) interfaces are members of a security zone.

#### The Golden Rules of ZPF Traffic Flow

1.  **Intra-Zone Traffic (Same Zone -> Same Zone):**
    *   If a packet travels between two interfaces that are members of the **same zone**, the traffic is **PASSED** by default.

2.  **Inter-Zone Traffic (Different Zone -> Different Zone):**
    *   If a packet travels between two interfaces in **different zones**, the traffic is **DROPPED** by default.
    *   To allow this traffic, you **must** configure a **zone-pair** and apply a policy that explicitly permits (`pass` or `inspect`) it.

3.  **Zone to "Non-Zone" Traffic:**
    *   If a packet travels from an interface that **is** a zone member to one that **is not** (or vice-versa), the traffic is **DROPPED**.
    *   This is a crucial security feature that prevents traffic from "leaking" out of the firewall policy.

4.  **Legacy Behavior (No Zones):**
    *   If a packet travels between two interfaces that are **not** members of any zone, the traffic is **PASSED**. The router simply performs its normal routing function without any firewall inspection.

---
#### Summary Table of Default Actions

| Source Interface (Ingress) | Destination Interface (Egress) | Default Action |
| :--- | :--- | :--- |
| **Same Zone** | **Same Zone** | **PASS** |
| Different Zone | Different Zone | **DROP** (Requires a policy to be permitted) |
| Zone Member | Not a Zone Member | **DROP** |
| Not a Zone Member | Not a Zone Member | **PASS** (Legacy Routing) |


---

# 16.2.3: ZPF Rules for the Self Zone

#### Core Concept
*   The **Self Zone** is a special, logical zone that represents the router itself.
*   It includes all IP addresses configured on the router's interfaces.
*   This applies to traffic **to** the router (e.g., SSH, SNMP, routing updates) or **from** the router (e.g., pings, routing updates).

---
#### The Golden Rule for the Self Zone
The rules for the self zone are different from the rules for transit traffic.

*   **By default, all traffic to and from the self zone is PASSED.**
*   This is a critical exception to the "deny by default" inter-zone rule. It ensures that, by default, you can still manage the router and that routing protocols continue to function.

#### The Exception: Overriding the Default
*   You can **override** this default `pass` behavior by creating an explicit policy for a zone-pair that involves the self zone (e.g., from `OUTSIDE-ZONE` to `SELF-ZONE`).
*   If a policy exists for that zone-pair, the specified action (`inspect`, `drop`, or `pass`) will be applied instead of the default.

---
#### Summary of Actions

| Scenario                                                      | Default Action (if no policy exists) | Action (if a policy DOES exist)       |
| :------------------------------------------------------------ | :----------------------------------- | :------------------------------------ |
| Traffic from any zone **to** the router (**self zone**)       | **PASS**                             | **Policy Action is Applied (e.g., Inspect/Drop)** |
| Traffic from the router (**self zone**) **to** any zone       | **PASS**                             | **Policy Action is Applied (e.g., Inspect/Drop)** |
